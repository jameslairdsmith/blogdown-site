---
title: Sandbox
author: James Laird-Smith
date: '2019-05-24'
slug: sandbox
categories: []
tags: []
header:
  caption: ''
  image: ''
draft: true
affiliatelink: http://example.org/
---



<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ──────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.2.0     ✔ purrr   0.3.2
## ✔ tibble  2.1.3     ✔ dplyr   0.8.3
## ✔ tidyr   1.0.0     ✔ stringr 1.4.0
## ✔ readr   1.3.1     ✔ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ─────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(htmltools)</code></pre>
<pre class="r"><code>doc &lt;- 
  tags$html(
    tags$head(
      tags$title(&#39;My first page&#39;)),
    tags$body(
      h1(&#39;My first heading&#39;),
      p(&#39;My first paragraph, with some &#39;, strong(&#39;bold&#39;), &#39; text.&#39;),
      div(class=&#39;article-metadata&#39;, &#39;Here is a div with an article metadata attribute&#39;),
      div(id=&#39;myDiv&#39;, class=&#39;simpleDiv&#39;, &#39;Here is a div with some attributes.&#39;))
)

cat(as.character(doc))</code></pre>
<pre><code>## &lt;html&gt;
##   &lt;body&gt;
##     &lt;h1&gt;My first heading&lt;/h1&gt;
##     &lt;p&gt;
##       My first paragraph, with some 
##       &lt;strong&gt;bold&lt;/strong&gt;
##        text.
##     &lt;/p&gt;
##     &lt;div class=&quot;article-metadata&quot;&gt;Here is a div with an article metadata attribute&lt;/div&gt;
##     &lt;div id=&quot;myDiv&quot; class=&quot;simpleDiv&quot;&gt;Here is a div with some attributes.&lt;/div&gt;
##   &lt;/body&gt;
## &lt;/html&gt;</code></pre>
<pre class="r"><code>#doc</code></pre>
<pre class="r"><code>make_html &lt;- function(){doc &lt;- 
  tags$html(
    tags$head(
      tags$title(&#39;My first page&#39;)),
    tags$body(
      h1(&#39;My first heading&#39;),
      p(&#39;My first paragraph, with some &#39;, strong(&#39;bold&#39;), &#39; text.&#39;),
      div(class=&#39;article-metadata&#39;, &#39;Here is a div with an article metadata attribute&#39;),
      div(id=&#39;myDiv&#39;, class=&#39;simpleDiv&#39;, &#39;Here is a div with some attributes.&#39;))
)

#cat(as.character(doc))
doc}</code></pre>
<pre class="r"><code>make_html()</code></pre>
<html>
<body>
<h1>My first heading</h1>
<p>
My first paragraph, with some 
<strong>bold</strong>
 text.
</p>
<div class="article-metadata">Here is a div with an article metadata attribute</div>
<div id="myDiv" class="simpleDiv">Here is a div with some attributes.</div>
</body>
</html>
<pre class="r"><code>tags$html(
    tags$head(
      tags$title(&#39;My first page&#39;)),
    tags$body(
      h1(&#39;My first heading&#39;),
      p(&#39;My first paragraph, with some &#39;, strong(&#39;bold&#39;), &#39; text.&#39;),
      div(class=&#39;article-metadata&#39;, &#39;Here is a div with an article metadata attribute&#39;),
      div(id=&#39;myDiv&#39;, class=&#39;simpleDiv&#39;, &#39;Here is a div with some attributes.&#39;)))</code></pre>
<html>
<body>
<h1>My first heading</h1>
<p>
My first paragraph, with some 
<strong>bold</strong>
 text.
</p>
<div class="article-metadata">Here is a div with an article metadata attribute</div>
<div id="myDiv" class="simpleDiv">Here is a div with some attributes.</div>
</body>
</html>
<pre class="r"><code>test &lt;-
  tags$html(
  tags$head(
    tags$title(&#39;Embedding Vega-Lite&#39;),
    tags$script(src=&quot;https://d3js.org/d3.v5.js&quot;),
    tags$script(src=&quot;https://cdn.jsdelivr.net/npm/vega@4.2.0&quot;),
    tags$script(src=&quot;https://cdn.jsdelivr.net/npm/vega-lite@3.0.0-rc6&quot;),
    tags$script(src=&quot;https://cdn.jsdelivr.net/npm/vega-embed@3.19.2&quot;),
    tags$style(paste0(&quot;.role-axis-label {&quot;,
      css(
        font.size = paste0(0.9, &#39;rem&#39;),
        fill = &#39;red&#39;,
        color = &#39;red&#39;), &quot;}&quot;)
    )
  ),
  tags$body(
    tags$script(src=&quot;https://d3js.org/d3.v5.js&quot;),
    tags$script(src=&quot;https://cdn.jsdelivr.net/npm/vega@4.2.0&quot;),
    tags$script(src=&quot;https://cdn.jsdelivr.net/npm/vega-lite@3.0.0-rc6&quot;),
    tags$script(src=&quot;https://cdn.jsdelivr.net/npm/vega-embed@3.19.2&quot;),
    tags$div(id=&quot;pppblock&quot;, align=&quot;center&quot;,
      tags$h3(align=&quot;left&quot;, id=&quot;ppphead&quot;, &quot;Purchasing Power Parity (PPP)&quot;),
      tags$p(align=&quot;left&quot;, id=&quot;pppsubhead&quot;, &#39;Difference from South Africa, 2017&#39;)
    ),
    tags$div(id=&quot;pppvis&quot;, align=&quot;center&quot;, class=&quot;role-axis-label&quot;),
    tags$p(align=&quot;right&quot;, id=&quot;pppsource&quot;, &#39;Source: Eurostat-OECD&#39;),
    tags$script(type=&quot;text/javascript&quot;, &quot;var maxWidth = 500&quot;),
    includeScript(&quot;sandbox_files/sandbox.js&quot;, type=&quot;text/javascript&quot;)
  )
)

test</code></pre>
<html>
<body>
<script src="https://d3js.org/d3.v5.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vega@4.2.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@3.0.0-rc6"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@3.19.2"></script>
<div id="pppblock" align="center">
<h3 align="left" id="ppphead">Purchasing Power Parity (PPP)</h3>
<p align="left" id="pppsubhead">Difference from South Africa, 2017</p>
</div>
<div id="pppvis" align="center" class="role-axis-label"></div>
<p align="right" id="pppsource">Source: Eurostat-OECD</p>
<script type="text/javascript">var maxWidth = 500</script>
<script type="text/javascript">var width = document.getElementById("pppvis").offsetWidth;
  
    //var maxWidth = 550; // setting the maximum width of the chart.
    //var width = 300;

    var getWorkingWidth = function(width,maxWidth){
                                                if(width < maxWidth)
                                                {return 1 * width}
                                                else{return maxWidth}
                                              };

    var workingWidth = getWorkingWidth(width, maxWidth);
    
    var height = Math.max(2/3 * workingWidth, 500)
    
    //var height = 7/10 * workingWidth
  
    
    var leftMargin = (width - workingWidth)/2;
    
    var rightMargin = leftMargin;
    
    document.getElementById("ppphead")
    .setAttribute(
      "style",`
      margin-left: ${leftMargin}px;
      margin-right: ${rightMargin}px`);
    
    document.getElementById("pppsubhead")
    .setAttribute(
      "style",`
      margin-left: ${leftMargin}px;
      margin-right: ${rightMargin}px;
      font-style: italic;
      margin-bottom: 10;
      text-align:left;`);
    
    document.getElementById("pppsource")
    .setAttribute(
      "style", `
      margin-left: ${leftMargin}px; 
      margin-right: ${rightMargin}px;
      font-size: 0.7rem;
      color: #696969;
      //margin-bottom: 0; 
      text-align:right;`);
    
    
    var el = document.getElementById('pppsubhead');
    var style = window.getComputedStyle(el, null).getPropertyValue('font-size');
    var fontFamily = window.getComputedStyle(el, null).getPropertyValue('font-family');
    var subFontSize = parseFloat(style); 
  
    var yourVlSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v3.json",
  "width": workingWidth,
      "height": height,
      "autosize": {
        "type": "fit",
        "contains": "padding"
      },
  "data": {
    "url": "https://gist.githubusercontent.com/jameslairdsmith/68081008a67515d3d565482816d78508/raw/d3acd665c1119def9386b25e4bca903a0038595a/clean_country_ppp.csv"
  },
  "transform": [{"calculate": "datum.ZAF_adj_ppp-0", "as": "ZAF_adj_ppp2"}],
  "mark": "bar",
  "encoding": {
    "x": {
      "field": "ZAF_adj_ppp2",
      "type": "quantitative",
      "scale": {"domain": [-1.5, 9]},
      "axis":{
        "labelFontSize": subFontSize-3,
        "labelFont": fontFamily,
        "title": null
      }
    },
    "y": {
      "field": "country_name",
      "type": "nominal",
      "sort": {"op": "sum", "field": "ZAF_adj_ppp2", "order":"descending"},
      "axis":{
        "labelFontSize": subFontSize-3,
        "labelFont": fontFamily,
        "title": null
      }  
    },
    "color": {
      "field": "continent",
      "type": "nominal",
      "legend": {
        "labelFontSize": subFontSize-3,
        "labelFont": fontFamily,
        "title": null,
        "orient":"bottom-right"
      }
    }
  }
}
    
    var opt = {
      "actions": false,
      "tooltip": false
    }
    vegaEmbed("#pppvis", yourVlSpec, opt);</script>
</body>
</html>
<pre class="r"><code>#test</code></pre>
<pre class="r"><code>test &lt;-
  tags$html(
  tags$header(
    tags$title(&#39;Embedding Vega-Lite&#39;),
    tags$script(src=&quot;https://d3js.org/d3.v5.js&quot;),
    tags$script(src=&quot;https://cdn.jsdelivr.net/npm/vega@4.2.0&quot;),
    tags$script(src=&quot;https://cdn.jsdelivr.net/npm/vega-lite@3.0.0-rc6&quot;),
    tags$script(src=&quot;https://cdn.jsdelivr.net/npm/vega-embed@3.19.2&quot;),
    tags$style(paste0(&quot;.role-axis-label {&quot;,
      css(
        font.size = paste0(0.9, &#39;rem&#39;),
        fill = &#39;red&#39;,
        color = &#39;red&#39;), &quot;}&quot;)
    )
  ),
  tags$body(
    tags$div(id=&quot;pppblock2&quot;, align=&quot;center&quot;,
      tags$h3(align=&quot;left&quot;, id=&quot;ppphead2&quot;, &quot;Purchasing Power Parity (PPP)&quot;),
      tags$p(align=&quot;left&quot;, id=&quot;pppsubhead2&quot;, &#39;Difference from South Africa, 2017&#39;)
    ),
    tags$div(id=&quot;pppvis2&quot;, align=&quot;center&quot;, class=&quot;role-axis-label&quot;),
    tags$p(align=&quot;right&quot;, id=&quot;pppsource2&quot;, &#39;Source: Eurostat-OECD&#39;),
    #tags$script(type=&quot;text/javascript&quot;, includeScript(&quot;&quot;sandbox_files/sandbox.js&quot;&quot;))
    includeScript(&quot;sandbox_files/sandbox2.js&quot;, type=&quot;text/javascript&quot;)
  )
)

test</code></pre>
<html>
<header>
<title>Embedding Vega-Lite</title>
<script src="https://d3js.org/d3.v5.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vega@4.2.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@3.0.0-rc6"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@3.19.2"></script>
<style>.role-axis-label {font-size:0.9rem;fill:red;color:red;}</style>
</header>
<body>
<div id="pppblock2" align="center">
<h3 align="left" id="ppphead2">Purchasing Power Parity (PPP)</h3>
<p align="left" id="pppsubhead2">Difference from South Africa, 2017</p>
</div>
<div id="pppvis2" align="center" class="role-axis-label"></div>
<p align="right" id="pppsource2">Source: Eurostat-OECD</p>
<script type="text/javascript">var width = document.getElementById("pppvis2").offsetWidth;
  
    var maxWidth = 550; // setting the maximum width of the chart.
    //var width = 300;

    var getWorkingWidth = function(width,maxWidth){
                                                if(width < maxWidth)
                                                {return 1 * width}
                                                else{return maxWidth}
                                              };

    var workingWidth = getWorkingWidth(width, maxWidth);
    
    var height = Math.max(2/3 * workingWidth, 500)
    
    //var height = 7/10 * workingWidth
  
    
    var leftMargin = (width - workingWidth)/2;
    
    var rightMargin = leftMargin;
    
    document.getElementById("ppphead2")
    .setAttribute(
      "style",`
      margin-left: ${leftMargin}px;
      margin-right: ${rightMargin}px`);
    
    document.getElementById("pppsubhead2")
    .setAttribute(
      "style",`
      margin-left: ${leftMargin}px;
      margin-right: ${rightMargin}px;
      font-style: italic;
      margin-bottom: 10;
      text-align:left;`);
    
    document.getElementById("pppsource2")
    .setAttribute(
      "style", `
      margin-left: ${leftMargin}px; 
      margin-right: ${rightMargin}px;
      font-size: 0.7rem;
      color: #696969;
      //margin-bottom: 0; 
      text-align:right;`);
    
    
    var el = document.getElementById('pppsubhead2');
    var style = window.getComputedStyle(el, null).getPropertyValue('font-size');
    var fontFamily = window.getComputedStyle(el, null).getPropertyValue('font-family');
    var subFontSize = parseFloat(style); 
  
    var yourVlSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v3.json",
  "width": workingWidth,
      "height": height,
      "autosize": {
        "type": "fit",
        "contains": "padding"
      },
  "data": {
    "url": "https://gist.githubusercontent.com/jameslairdsmith/68081008a67515d3d565482816d78508/raw/d3acd665c1119def9386b25e4bca903a0038595a/clean_country_ppp.csv"
  },
  "transform": [{"calculate": "datum.ZAF_adj_ppp-0", "as": "ZAF_adj_ppp2"}],
  "mark": "bar",
  "encoding": {
    "x": {
      "field": "ZAF_adj_ppp2",
      "type": "quantitative",
      "scale": {"domain": [-1.5, 9]},
      "axis":{
        "labelFontSize": subFontSize-3,
        "labelFont": fontFamily,
        "title": null
      }
    },
    "y": {
      "field": "country_name",
      "type": "nominal",
      "sort": {"op": "sum", "field": "ZAF_adj_ppp2", "order":"descending"},
      "axis":{
        "labelFontSize": subFontSize-3,
        "labelFont": fontFamily,
        "title": null
      }  
    },
    "color": {
      "field": "continent",
      "type": "nominal",
      "legend": {
        "labelFontSize": subFontSize-3,
        "labelFont": fontFamily,
        "title": null,
        "orient":"bottom-right"
      }
    }
  }
}
    
    var opt = {
      "actions": false,
      "tooltip": false
    }
    vegaEmbed("#pppvis2", yourVlSpec, opt);</script>
</body>
</html>
<pre class="r"><code>#test</code></pre>
